{"version":3,"file":"ecf.min.js","sources":["../src/ecf.js"],"sourcesContent":["/**\r\n* @license\r\n* Copyright (c) Jason Go\r\n*\r\n* This Source Code Form is subject to the terms of the Mozilla Public\r\n* License, v. 2.0. If a copy of the MPL was not distributed with this\r\n* file, You can obtain one at http://mozilla.org/MPL/2.0/.\r\n*\r\n* SPDX-License-Identifier: MPL-2.0\r\n*/\r\n/* global iFrameResize, parentIFrame */\r\n;(function () {\r\n  const ECF = function (url, config = {}) {\r\n    config.resizer = Object.assign({\r\n      log: false,\r\n      checkOrigin: true,\r\n      heightCalculationMethod: 'taggedElement',\r\n      onMessage: ({ iframe, message }) => {\r\n        if (message === 'ecfready') {\r\n          document.getElementById(iframe.id + '-spinner').style.display = 'none'\r\n          iframe.style.display = 'block'\r\n          const animation = iframe.getAttribute('data-animation')\r\n          if (animation !== 'none') {\r\n            iframe.classList.add('animate__animated', animation)\r\n          }\r\n        }\r\n      }\r\n    }, config.resizer)\r\n\r\n    config = Object.assign({\r\n      width: '100%',\r\n      height: 'auto',\r\n      id: 'ecf-' + new Date().getTime(),\r\n      spinner: true,\r\n      animation: 'animate__fadeIn',\r\n      hideFooter: true,\r\n      insertPosition: 'afterend',\r\n      insertInto: ''\r\n    }, config)\r\n\r\n    let ecfNode = null\r\n    if (config.insertInto === '') {\r\n      ecfNode = document.currentScript || (function () {\r\n        const scripts = document.getElementsByTagName('script')\r\n        return scripts[scripts.length - 1]\r\n      })()\r\n    } else {\r\n      ecfNode = document.querySelector(config.insertInto)\r\n    }\r\n\r\n    if (config.animation !== 'none') {\r\n      ecfNode.insertAdjacentHTML(config.insertPosition, '<style>@import url(https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css);</style>')\r\n    }\r\n\r\n    const spinner = `<div id=\"${config.id}-spinner\" class=ecf-spinner style=text-align:center><svg height=32px version=1.0 viewBox=\"0 0 128 128\"width=32px xml:space=preserve xmlns=http://www.w3.org/2000/svg xmlns:svg=http://www.w3.org/2000/svg xmlns:xlink=http://www.w3.org/1999/xlink><g><path d=\"M.6 57.54c5.73-6.23 17.33-15.5 33.66-12.35C55.4 48.5 64 63.95 64 63.95S42.42 65 30.28 83.63a38.63 38.63 0 0 0-3.4 32.15 64.47 64.47 0 0 1-5.52-4.44A63.64 63.64 0 0 1 .6 57.54z\"fill=#ffcb02 /><path d=\"M65.32 29.05c7.65 19.98-1.44 35.18-1.44 35.18S52.2 46.05 30.03 44.85A38.6 38.6 0 0 0 .56 57.93 63.8 63.8 0 0 1 37.56 6c8.2 1.8 22.26 7.16 27.76 23.05z\"fill=#ff9e02 /><path d=\"M94.92 47.7c-13.48 16.63-31.2 16.36-31.2 16.36s9.92-19.2-.13-39a38.6 38.6 0 0 0-26.18-19 63.78 63.78 0 0 1 63.52 6.03c2.56 8 4.98 22.85-6.05 35.6z\"fill=#ff4b42 /><path d=\"M93.52 82.53C72.38 79.17 63.75 63.7 63.75 63.7s21.6-1.02 33.7-19.63a38.6 38.6 0 0 0 3.43-32.04 64.33 64.33 0 0 1 5.74 4.6 63.63 63.63 0 0 1 20.82 53.26c-5.62 6.2-17.34 15.8-33.94 12.6z\"fill=#c063d6 /><path d=\"M62.5 99c-7.65-19.98 1.44-35.17 1.44-35.17S75.56 81.6 97.74 82.8a39.1 39.1 0 0 0 29.73-13.03 63.8 63.8 0 0 1-37.16 52.3c-8.2-1.8-22.25-7.15-27.8-23.06z\"fill=#17a4f6 /><path d=\"M26.64 115.63C24 107.6 21.6 93.06 32.5 80.5c13.48-16.62 31.58-16.55 31.58-16.55s-9.6 19.06.44 38.86a38.82 38.82 0 0 0 26.05 19.17 63.78 63.78 0 0 1-63.93-6.3z\"fill=#4fca24 /></g></svg></div><style>.ecf-spinner svg{animation:.4s linear infinite rotate;margin-top:40px;position:relative}@keyframes rotate{from{transform:rotate(0)}to{transform:rotate(360deg)}}</style>`\r\n    ecfNode.insertAdjacentHTML(config.insertPosition, spinner)\r\n    if (!config.spinner) {\r\n      document.querySelector(`#${config.id}-spinner`).style.display = 'none'\r\n    }\r\n\r\n    if (document.querySelector('#js-iframe-resizer') === null && config.height === 'auto') {\r\n      const r = document.createElement('script')\r\n      r.src = 'https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.3.1/iframeResizer.min.js'\r\n      r.crossOrigin = 'anonymous'\r\n      r.id = 'js-iframe-resizer'\r\n      document.getElementsByTagName('head')[0].appendChild(r)\r\n    }\r\n\r\n    const sm = url.match(/\\/offers\\/(.{8})/)\r\n    let iframeSrc = ''\r\n    if (typeof sm[1] === 'string') {\r\n      iframeSrc = config.resizer.checkOrigin ? 'https://' + window.location.hostname + '/offers/' + sm[1] + '/checkout' : url\r\n\r\n      // Pass the coupon code from top window\r\n      const coupon = (window.location.href.match(/coupon_code=(\\w+)(&|$)/) || url.match(/coupon_code=(\\w+)(&|$)/) || ['', ''])[1]\r\n      iframeSrc += coupon === '' ? '' : '?coupon_code=' + coupon\r\n\r\n      const i = document.createElement('iframe')\r\n      i.id = config.id\r\n      i.src = iframeSrc\r\n      i.allow = 'payment'\r\n      i.style.width = config.width\r\n      i.frameBorder = '0'\r\n      i.style.border = '0'\r\n      i.style.display = 'none'\r\n      i.style.minWidth = '330px'\r\n      i.setAttribute('data-animation', config.animation)\r\n      ecfNode.insertAdjacentElement(config.insertPosition, i)\r\n\r\n      if (config.height === 'auto') {\r\n        const ctrl = setInterval(function () {\r\n          if (typeof iFrameResize === 'function') {\r\n            clearInterval(ctrl)\r\n            iFrameResize(config.resizer, '#' + i.id)\r\n          }\r\n        }, 10)\r\n      } else {\r\n        i.style.height = config.height\r\n        document.getElementById(i.id + '-spinner').style.display = 'none'\r\n        i.style.display = 'block'\r\n        const animation = i.getAttribute('data-animation')\r\n        if (animation !== 'none') {\r\n          i.classList.add('animate__animated', animation)\r\n        }\r\n      }\r\n    } else {\r\n      return false\r\n    }\r\n  }\r\n  window.ECF = window.ECF || ECF\r\n  window.ecf = window.ecf || ECF\r\n\r\n  const ok = f => document.readyState[7] ? f() : setTimeout(ok, 9, f)\r\n\r\n  ok(function () {\r\n    const $ = function (q) { return document.querySelectorAll(q) }\r\n    if (document.body.classList.contains('offer-checkout') && (/\\?embed$/.test(window.location.href) || window.top !== window.self) && !(/editor=true/.test(window.location.href)) && !(/\\?noembed$/.test(window.location.href))) {\r\n      window.JGO_ECF = true\r\n      if (document.querySelector('#js-iframe-content') == null) {\r\n        const r = document.createElement('script')\r\n        r.src = 'https://cdnjs.cloudflare.com/ajax/libs/iframe-resizer/4.2.11/iframeResizer.contentWindow.min.js'\r\n        r.crossOrigin = 'anonymous'\r\n        r.id = 'js-iframe-content'\r\n        document.getElementsByTagName('head')[0].appendChild(r)\r\n      }\r\n\r\n      $('div.checkout-banner').length && $('div.checkout-banner')[0].remove()\r\n      $('#new_checkout_offer').length && $('#new_checkout_offer')[0].setAttribute('data-iframe-height', '')\r\n      $('div.col-md-6').length && $('div.col-md-6')[0].remove()\r\n      $('div.checkout-content-left').length && $('div.checkout-content-left')[0].classList.remove('col-md-offset-1', 'col-md-5', 'checkout-content-left')\r\n      $('div.content').length && $('div.content')[0].classList.remove('content')\r\n      $('div.container').length && $('div.container')[0].classList.remove('container')\r\n      $('div.row').length && $('div.row')[0].classList.remove('row')\r\n      $('.checkout-footer').length && $('.checkout-footer')[0].remove()\r\n\r\n      // Compatibility with 2-Step Checkout Styler\r\n      const panelheadstyle = window.JGO_2step ? 'div.panel-heading{padding:0}div.panel-heading>*:not(div){padding:32px 36px 0 36px}' : 'div.panel-heading{padding:32px 36px 32px 36px}div.panel-heading>*:not(div):not(.checkout-panel-badge){padding:0}'\r\n\r\n      const ecfstyle = document.createElement('style')\r\n      ecfstyle.innerHTML =\r\n`#preloader {width: 100% !important;height: 100% !important;left:0 !important;}\r\nbody {background-color:white}\r\ndiv.checkout-panel {margin:0}\r\ndiv.checkout-panel{box-shadow: 0 0 0 0 rgba(0,0,0,0.1)}\r\ndiv.panel-body {padding:36px}\r\ndiv.price-breakdown {padding: 17px 36px 17px 36px}\r\n.grecaptcha-badge{visibility: hidden;}\r\n${panelheadstyle}`\r\n\r\n      document.body.append(ecfstyle)\r\n\r\n      $('form')[0].setAttribute('target', '_top')\r\n      const ctrl = setInterval(function () {\r\n        if (typeof parentIFrame !== 'undefined') {\r\n          clearInterval(ctrl)\r\n          parentIFrame.sendMessage('ecfready')\r\n        }\r\n      }, 10)\r\n    }\r\n  })\r\n})()\r\n\r\n/*\r\nChange Log:\r\n\r\n1.0.4\r\n- Coupon codes can now be included in the ECF() function.\r\n\r\n1.0.3\r\n- Bug fix for missing elements that needs to be deleted, causing runtime error\r\n- Updated iframeresizer and animate.css\r\n\r\n1.0.2\r\n- Added style compatibility with 2-Step Checkout Styler\r\n- Main script src changed to https://codex.jasongo.net/ecf.js\r\n- Compatibility with Sweetcher\r\n\r\n1.0.1\r\n- Iframe resizer's heightCalculationMethod changed to 'taggedElement'\r\n- Tagged element is $('#new_checkout_offer')[0].setAttribute('data-iframe-height', '');\r\n- New height calculation makes ECF Safari compatible\r\n\r\n1.0.0\r\n- Initial stable release\r\n- davidjbradshaw/iframe-resizer is used to automatically resize checkout form\r\n\r\n0.0.1\r\n- Beta release\r\n*/\r\n"],"names":["ECF","url","config","resizer","Object","assign","log","checkOrigin","heightCalculationMethod","onMessage","_ref","iframe","message","document","getElementById","id","style","display","animation","getAttribute","classList","add","scripts","ecfNode","width","height","Date","getTime","spinner","hideFooter","insertPosition","insertInto","currentScript","getElementsByTagName","length","querySelector","insertAdjacentHTML","r","createElement","src","crossOrigin","appendChild","sm","match","iframeSrc","window","location","hostname","coupon","href","i","allow","frameBorder","border","minWidth","setAttribute","insertAdjacentElement","ctrl","setInterval","iFrameResize","clearInterval","ecf","ok","f","readyState","setTimeout","$","q","querySelectorAll","body","contains","test","top","self","JGO_ECF","remove","panelheadstyle","JGO_2step","ecfstyle","innerHTML","append","parentIFrame","sendMessage"],"mappings":"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"}